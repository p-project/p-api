#!/bin/bash

set -e

GREEN_BG='\033[1;37;42m'
GREY_BG='\033[0;30;47m'
BLUE_BG='\033[1;37;44m'
NC='\033[0m'

cd "$(dirname "$0")/../"

export SYMFONY_ENV=${SYMFONY_ENV:-dev}

echo
echo -e "   ${BLUE_BG} • ${GREY_BG} INITIALIZING PROJECT FOR ${GREEN_BG} ${SYMFONY_ENV} ${GREY_BG} ENVIRONMENT ${NC}"
echo

echo
echo -e "   ${BLUE_BG} • ${GREY_BG} INSTALLING DEPENDENCIES ${NC}"
echo

wget -N https://getcomposer.org/composer.phar
chmod +x composer.phar

if [ ${SYMFONY_ENV} = "dev" ]; then
    ./composer.phar install
else
    ./composer.phar install --no-interaction --optimize-autoloader
fi

rm -rf var/cache/${SYMFONY_ENV}

echo
echo -e "   ${BLUE_BG} • ${GREY_BG} CREATING DATABASES ${NC}"
echo

./bin/console doctrine:database:drop --force || true
./bin/console doctrine:database:create

echo
echo -e "   ${BLUE_BG} • ${GREY_BG} CREATING SCHEMA ${NC}"
echo

./bin/console doctrine:schema:create

echo
echo -e "   ${BLUE_BG} • ${GREY_BG} LOADING FIXTURES ${NC}"
echo

./bin/console hautelook:fixtures:load -n

echo
echo -e "   ${GREEN_BG} ✓ ${GREY_BG} RESET IS DONE ${NC}"
echo
